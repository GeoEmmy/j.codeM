<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìì¬ ì„ íƒ - J.codE M</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/common.css">
  <style>
    /* ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ */
    .main-nav {
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 50px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
      gap: 40px;
    }

    /* ë¡œê³  */
    .nav-brand .brand-link {
      display: flex;
      align-items: center;
      gap: 4px;
      text-decoration: none;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: -1.5px;
      transition: opacity 0.3s ease;
    }

    .nav-brand .brand-link:hover {
      opacity: 0.7;
    }

    .logo-text {
      color: var(--dark);
    }

    .logo-accent {
      color: var(--primary-color);
    }

    /* ì¤‘ì•™ ë©”ë‰´ */
    .nav-menu {
      display: flex;
      gap: 8px;
      flex: 1;
      justify-content: flex-start;
      max-width: 600px;
    }

    .nav-btn {
      position: relative;
      padding: 10px 28px;
      background: transparent;
      border: none;
      text-decoration: none;
      color: #636e72;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: -0.3px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      border-radius: 10px;
    }

    .nav-btn::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 2px;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    .nav-btn:hover {
      color: var(--primary-color);
      background: rgba(0, 184, 148, 0.05);
    }

    .nav-btn:hover::before {
      width: 60%;
    }

    .nav-btn.active {
      color: white;
      background: linear-gradient(135deg, #00b894 0%, #00a281 100%);
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.25);
    }

    .nav-btn.active::before {
      display: none;
    }

    /* ìš°ì¸¡ ì•¡ì…˜ ë²„íŠ¼ */
    .nav-actions {
      display: flex;
      gap: 12px;
    }

    .action-btn {
      padding: 10px 24px;
      background: white;
      border: 1.5px solid #e8ecf1;
      border-radius: 10px;
      text-decoration: none;
      color: #636e72;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
    }

    .comparison-btn {
      color: var(--primary-color);
      border-color: rgba(0, 184, 148, 0.3);
      background: rgba(0, 184, 148, 0.03);
    }

    .comparison-btn:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.25);
      transform: translateY(-1px);
    }

    .home-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(0, 184, 148, 0.03);
      transform: translateY(-1px);
    }

    /* ë°˜ì‘í˜• - íƒœë¸”ë¦¿ */
    @media (max-width: 1024px) {
      .main-nav {
        padding: 16px 30px;
        gap: 25px;
      }

      .nav-btn {
        padding: 9px 22px;
        font-size: 14px;
      }

      .action-btn {
        padding: 9px 20px;
        font-size: 13px;
      }

      .nav-brand .brand-link {
        font-size: 23px;
      }
    }

    /* ë°˜ì‘í˜• - ëª¨ë°”ì¼ */
    @media (max-width: 768px) {
      .main-nav {
        padding: 14px 20px;
        gap: 15px;
      }

      .nav-btn {
        padding: 8px 16px;
        font-size: 13px;
      }

      .action-btn {
        padding: 8px 16px;
        font-size: 12px;
      }

      .nav-brand .brand-link {
        font-size: 20px;
      }

      .nav-menu {
        gap: 6px;
      }

      .nav-actions {
        gap: 8px;
      }
    }

    /* ë” ì‘ì€ ëª¨ë°”ì¼ */
    @media (max-width: 480px) {
      .main-nav {
        padding: 12px 15px;
        gap: 10px;
      }

      .nav-btn {
        padding: 7px 12px;
        font-size: 12px;
      }

      .action-btn {
        padding: 7px 12px;
        font-size: 11px;
      }

      .comparison-btn {
        display: none; /* ë§¤ìš° ì‘ì€ í™”ë©´ì—ì„œëŠ” ìˆ¨ê¹€ */
      }
    }

    .page-wrapper {
      display: flex;
      min-height: 100vh;
      gap: 20px;
    }

    /* ë©”ì¸ ì»¨í…ì¸  - í”¼ë¼ë¯¸ë“œ */
    .main-content {
      flex: 1;
      padding: 0px;
      overflow-x: auto;
    }

    /* í˜ì´ì§€ íƒ€ì´í‹€ */
    .page-title {
      text-align: center;
      margin-bottom: 20px;
    }

    .page-title h2 {
      font-size: 28px;
      font-weight: 700;
      color: var(--dark);
      letter-spacing: -0.5px;
      margin: 0;
    }

    /* ìì¬ ì¹´í…Œê³ ë¦¬ í•„í„° */
    .material-filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 30px auto;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 12px 28px;
      background: white;
      border: 2px solid #e8ecf1;
      border-radius: 25px;
      color: #636e72;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: -0.3px;
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(0, 184, 148, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 184, 148, 0.15);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #00b894 0%, #00a281 100%);
      border-color: var(--primary-color);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
    }

    /* í”¼ë¼ë¯¸ë“œ ìŠ¤í…Œì´ì§€ - visibilityë¡œ ë³€ê²½ */
    .pyramid-stage {
      position: relative;
      width: 100%;
      max-width: 1800px;
      margin: 40px auto;
      padding: 60px 80px 100px;
      background: transparent;
      border-radius: 25px;
      overflow: visible;
      min-height: 900px; /* ìì¬ ì—†ì„ ë•Œë„ ë™ì¼í•œ ë†’ì´ ìœ ì§€ */
      visibility: hidden; /* opacity ëŒ€ì‹  visibility ì‚¬ìš© */
      transition: opacity 0.3s ease;
    }

    .pyramid-stage.loaded {
      visibility: visible; /* ë¡œë“œ ì™„ë£Œ ì‹œ ë³´ì´ê¸° */
      opacity: 1;
    }

    /* í•˜ë‚˜ì˜ í° í”¼ë¼ë¯¸ë“œ ë°°ê²½ (ì •ì‚¼ê°í˜•ì— ê°€ê¹ê²Œ - ë” í¬ê²Œ) */
    .pyramid-background {
      position: absolute;
      top: 48%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      border-left: 700px solid transparent;
      border-right: 700px solid transparent;
      border-bottom: 1350px solid rgba(0, 184, 148, 0.08);
      z-index: 0;
      pointer-events: none;
    }

    .pyramid-background::before {
      display: none;
    }

    /* íƒ€ì¼ ì»¨í…Œì´ë„ˆ - ë°°ê²½ê³¼ ì™„ì „íˆ ë…ë¦½ì  */
    .pyramid-tiles {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      width: 100%;
      pointer-events: auto; /* íƒ€ì¼ì€ í´ë¦­ ê°€ëŠ¥ */
    }

    /* ë¹ˆ ìì¬ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ */
    .empty-materials-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      text-align: center;
      color: #95a5a6;
      background: transparent;
      padding: 20px 30px;
      font-size: 14px;
      font-weight: 500;
    }

    /* ê° ë ˆë²¨ í–‰ + ì–‡ì€ êµ¬ë¶„ì„  */
    .pyramid-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      flex-wrap: nowrap; /* í•œ ì¤„ë¡œ ìœ ì§€ */
      padding: 20px 30px;
      transition: all 0.3s ease;
      position: relative;
      border-bottom: none; /* ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ë¶„ì„  ì—†ìŒ */
    }

    /* ê·¸ë£¹ì˜ ë§ˆì§€ë§‰ í–‰ì—ë§Œ êµ¬ë¶„ì„  í‘œì‹œ */
    .pyramid-row.group-end {
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      padding-bottom: 30px;
      margin-bottom: 10px;
    }

    /* 11ê°œ í–‰ì˜ ë„ˆë¹„ ì„¤ì • - ìŠ¬ë¡¯ ê°œìˆ˜: 1,2,3,4,6,7,8,10,12,14,16 */
    .pyramid-row.row-1 { max-width: 100px; }     /* 1ì¹¸: 70px + ì—¬ìœ  */
    .pyramid-row.row-2 { max-width: 185px; }     /* 2ì¹¸: 155px + ì—¬ìœ  */
    .pyramid-row.row-3 { max-width: 270px; }     /* 3ì¹¸: 240px + ì—¬ìœ  */
    .pyramid-row.row-4 { max-width: 355px; }     /* 4ì¹¸: 325px + ì—¬ìœ  */
    .pyramid-row.row-5 { max-width: 525px; }     /* 6ì¹¸: 495px + ì—¬ìœ  */
    .pyramid-row.row-6 { max-width: 610px; }     /* 7ì¹¸: 580px + ì—¬ìœ  */
    .pyramid-row.row-7 { max-width: 695px; }     /* 8ì¹¸: 665px + ì—¬ìœ  */
    .pyramid-row.row-8 { max-width: 865px; }     /* 10ì¹¸: 835px + ì—¬ìœ  */
    .pyramid-row.row-9 { max-width: 1035px; }    /* 12ì¹¸: 1005px + ì—¬ìœ  */
    .pyramid-row.row-10 { max-width: 1205px; }   /* 14ì¹¸: 1175px + ì—¬ìœ  */
    .pyramid-row.row-11 { max-width: 1375px; }   /* 16ì¹¸: 1345px + ì—¬ìœ  */

    /* ë ˆë²¨ë³„ ìƒ‰ìƒì€ ìœ ì§€ */
    .pyramid-row.level-1,
    .pyramid-row.level-2,
    .pyramid-row.level-3,
    .pyramid-row.level-4,
    .pyramid-row.level-5 {
      background: transparent;
    }

    /* ë ˆë²¨ ë¼ë²¨ ì œê±° */
    .pyramid-row::before {
      display: none;
    }

    /* ë¹ˆ ë ˆë²¨ ìŠ¤íƒ€ì¼ */
    .pyramid-row.empty-level {
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(200, 200, 200, 0.05);
    }

    .empty-message {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      opacity: 0.5;
    }

    .range-label {
      font-size: 11px;
      font-weight: 600;
      color: #636e72;
      letter-spacing: 0.5px;
    }

    .no-materials {
      font-size: 10px;
      color: #95a5a6;
      font-style: italic;
    }

    /* ìì¬ íƒ€ì¼ */
    .material-tile {
      width: 70px;
      height: 70px;
      min-width: 70px;  /* ìµœì†Œ í¬ê¸° ë³´ì¥ */
      min-height: 70px; /* ìµœì†Œ í¬ê¸° ë³´ì¥ */
      flex-shrink: 0; /* íƒ€ì¼ì´ ì ˆëŒ€ ì¶•ì†Œë˜ì§€ ì•Šë„ë¡ */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.15),
                  inset 0 0 0 1px rgba(255,255,255,0.3);
    }

    .material-tile::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg,
        rgba(0,0,0,0) 0%,
        rgba(0,0,0,0.2) 100%);
      opacity: 0.6;
      transition: opacity 0.3s;
    }

    .material-tile:hover {
      transform: translateY(-8px) scale(1.1);
      box-shadow: 0 12px 24px rgba(0,184,148,0.4),
                  inset 0 0 0 2px var(--primary-color);
      z-index: 100;
    }

    .material-tile:hover::before {
      opacity: 0.2;
    }

    .material-tile.selected {
      box-shadow: 0 0 0 5px var(--primary-color),
                  0 15px 40px rgba(0,184,148,0.5);
      transform: scale(1.08);
    }

    .material-tile.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      animation: checkPop 0.3s ease;
    }

    @keyframes checkPop {
      0% { transform: translate(-50%, -50%) scale(0); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    /* ë¹ˆ ìŠ¬ë¡¯ ìŠ¤íƒ€ì¼ */
    .material-tile.empty-slot {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));  /* ê¸€ë¡œì‹œí•œ ê·¸ë¼ë””ì–¸íŠ¸ */
      border: none;
      cursor: default;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08),
                  inset 0 1px 2px rgba(255, 255, 255, 0.8);  /* ì™¸ë¶€ ê·¸ë¦¼ì + ë‚´ë¶€ í•˜ì´ë¼ì´íŠ¸ */
      flex-shrink: 0;
      opacity: 0.2;  /* ì „ì²´ íˆ¬ëª…ë„ */
    }

    .material-tile.empty-slot::before {
      display: none;
    }

    .material-tile.empty-slot:hover {
      transform: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08),
                  inset 0 1px 2px rgba(255, 255, 255, 0.8);
      z-index: auto;
    }

    .empty-slot-label {
      display: none; /*position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      color: rgba(0, 0, 0, 0.1);
      font-weight: 300;*/
    }

    /* íƒ€ì¼ ì˜¤ë²„ë ˆì´ (í˜¸ë²„ ì‹œ ì •ë³´ í‘œì‹œ) */
    .material-tile .tile-info {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top,
        rgba(0,0,0,0.95) 0%,
        rgba(0,0,0,0.8) 70%,
        transparent 100%);
      padding: 10px 8px 8px;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .material-tile:hover .tile-info {
      transform: translateY(0);
    }

    .material-tile .tile-name {
      font-size: 9px;
      font-weight: 700;
      color: white;
      text-align: center;
      display: block;
      text-shadow: 0 1px 3px rgba(0,0,0,0.8);
      margin-bottom: 3px;
      line-height: 1.1;
    }

    .material-tile .tile-gwp {
      font-size: 8px;
      font-weight: 600;
      color: var(--primary-color);
      text-align: center;
      display: block;
      background: rgba(255,255,255,0.95);
      padding: 2px 5px;
      border-radius: 5px;
    }

    /* GWP ë±ƒì§€ (í•­ìƒ í‘œì‹œ) */
    .material-tile .gwp-badge {
      position: absolute;
      top: 4px;
      left: 4px;
      background: rgba(0,0,0,0.75);
      color: white;
      padding: 3px 6px;
      border-radius: 8px;
      font-size: 9px;
      font-weight: 700;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* ë ˆë²¨ë³„ ìƒ‰ìƒ ë±ƒì§€ */
    .material-tile .level-indicator {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 1.5px solid white;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }

    .level-1 .level-indicator { background: #d63031; }  /* ë§¨ ìœ„ - 10,000 ì´ìƒ (ë¹¨ê°•) */
    .level-2 .level-indicator { background: #fdcb6e; }  /* 1,000 ì´ìƒ (ì£¼í™©) */
    .level-3 .level-indicator { background: #74b9ff; }  /* 100 ì´ìƒ (í•˜ëŠ˜ìƒ‰) */
    .level-4 .level-indicator { background: #55efc4; }  /* 0 ì´ìƒ (ë¯¼íŠ¸) */
    .level-5 .level-indicator { background: #00b894; }  /* ë§¨ ì•„ë˜ - 0 ë¯¸ë§Œ (ë…¹ìƒ‰) */

    /* ì¹´í…Œê³ ë¦¬ í•„í„° ë©”ë‰´ */
    .material-filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 30px auto 40px;
      padding: 0 20px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 12px 24px;
      background: white;
      border: 2px solid #e8ecf1;
      border-radius: 25px;
      font-size: 12px;
      font-weight: 600;
      color: #636e72;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: -0.3px;
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      background: rgba(0, 184, 148, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 184, 148, 0.15);
    }

    .filter-btn.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .pyramid-stage {
        padding: 50px 20px 40px;
      }

      .material-tile {
        width: 70px;  /* 70px ìœ ì§€ */
        height: 70px; /* 70px ìœ ì§€ */
      }

      .pyramid-row {
        gap: 15px;  /* gapë„ ìœ ì§€ */
      }

      .page-title h2 {
        font-size: 24px;
      }
    }

    @media (max-width: 480px) {
      .pyramid-stage {
        padding: 40px 15px 30px;
      }

      .material-tile {
        width: 70px;  /* 70px ìœ ì§€ */
        height: 70px; /* 70px ìœ ì§€ */
      }

      .pyramid-row {
        gap: 15px;  /* gapë„ ìœ ì§€ */
      }

      .page-title h2 {
        font-size: 20px;
      }
    }

    /* ìì¬ ëª©ë¡ ì„¹ì…˜ (ì‚¬ìš© ì•ˆ í•¨) */
      color: #636e72;
      font-size: 14px;
      font-weight: 500;
    }

    /* ìì¬ ëª©ë¡ ì„¹ì…˜ */
    .materials-section {
      max-width: 1200px;
      margin: 40px auto;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: var(--shadow);
    }

    .materials-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 25px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .materials-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 15px;
      justify-items: center;
    }

    .material-card-new {
      width: 100px;
      height: 100px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15),
                  inset 0 0 0 2px rgba(255,255,255,0.2);
    }

    .material-card-new::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.3) 100%);
      opacity: 0.5;
      transition: opacity 0.3s;
    }

    .material-card-new:hover {
      transform: translateY(-12px) scale(1.08);
      box-shadow: 0 20px 40px rgba(0,184,148,0.3),
                  inset 0 0 0 3px var(--primary-color);
      z-index: 10;
    }

    .material-card-new:hover::before {
      opacity: 0.2;
    }

    .material-card-new.selected {
      box-shadow: 0 0 0 4px var(--primary-color),
                  0 12px 30px rgba(0,184,148,0.4);
      transform: scale(1.05);
    }

    .material-card-new.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 5px;
      right: 5px;
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .material-card-new .material-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 70%, transparent 100%);
      padding: 8px 6px 6px;
      transform: translateY(100%);
      transition: transform 0.3s;
    }

    .material-card-new:hover .material-overlay {
      transform: translateY(0);
    }

    .material-card-new .material-name {
      font-size: 11px;
      font-weight: 700;
      color: white;
      text-align: center;
      display: block;
      text-shadow: 0 1px 3px rgba(0,0,0,0.8);
      margin-bottom: 3px;
      line-height: 1.2;
    }

    .material-card-new .gwp-value {
      font-size: 10px;
      font-weight: 600;
      color: var(--primary-color);
      text-align: center;
      display: block;
      background: rgba(255,255,255,0.95);
      padding: 2px 4px;
      border-radius: 4px;
    }

    .material-card-new .gwp-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: rgba(0,184,148,0.95);
      color: white;
      padding: 3px 7px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    /* ë ˆë²¨ ë±ƒì§€ */
    .level-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .level-badge.level-1 { background: #d63031; color: white; }  /* 10,000 ì´ìƒ */
    .level-badge.level-2 { background: #fdcb6e; color: #2d3436; }  /* 1,000 ì´ìƒ */
    .level-badge.level-3 { background: #74b9ff; color: white; }  /* 100 ì´ìƒ */
    .level-badge.level-4 { background: #55efc4; color: #2d3436; }  /* 0 ì´ìƒ */
    .level-badge.level-5 { background: #00b894; color: white; }  /* 0 ë¯¸ë§Œ */

    .pyramid-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      padding: 40px 20px;
      background: white;
      border-radius: 20px;
      box-shadow: var(--shadow);
      min-width: 800px;
    }

    .pyramid-level {
      display: flex;
      justify-content: center;
      gap: 10px;
      width: 100%;
      position: relative;
      flex-wrap: wrap;
    }

    .pyramid-level::before {
      content: attr(data-label);
      position: absolute;
      left: -150px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      font-weight: 600;
      color: #636e72;
      white-space: nowrap;
    }

    /* í”¼ë¼ë¯¸ë“œ ë ˆë²¨ë³„ ë„ˆë¹„ */
    .pyramid-level.level-1 { max-width: 95%; }  /* ìµœì € - ê°€ì¥ ë„“ìŒ */
    .pyramid-level.level-2 { max-width: 80%; }
    .pyramid-level.level-3 { max-width: 65%; }
    .pyramid-level.level-4 { max-width: 50%; }
    .pyramid-level.level-5 { max-width: 35%; }  /* ìµœê³  - ê°€ì¥ ì¢ìŒ */

    /* ìì¬ ì•„ì´í…œ */
    .material-item {
      flex: 0 0 auto;
      width: 150px;
      padding: 15px;
      background: white;
      border: 2px solid transparent;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .material-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
      border-color: var(--primary-color);
    }

    .material-item.selected {
      border-color: var(--primary-color);
      background: #f0fff9;
      box-shadow: 0 5px 20px rgba(0, 184, 148, 0.3);
    }

    /* ë ˆë²¨ë³„ ìƒ‰ìƒ */
    .material-item.level-1 { border-left: 5px solid #d63031; }  /* ë¹¨ê°„ìƒ‰ - 10,000 ì´ìƒ */
    .material-item.level-2 { border-left: 5px solid #fdcb6e; }  /* ì£¼í™©ìƒ‰ - 1,000 ì´ìƒ */
    .material-item.level-3 { border-left: 5px solid #74b9ff; }  /* í•˜ëŠ˜ìƒ‰ - 100 ì´ìƒ */
    .material-item.level-4 { border-left: 5px solid #55efc4; }  /* ë¯¼íŠ¸ìƒ‰ - 0 ì´ìƒ */
    .material-item.level-5 { border-left: 5px solid #00b894; }  /* ë…¹ìƒ‰ - 0 ë¯¸ë§Œ */

    .material-item .material-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
      min-height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .material-item .gwp-value {
      font-size: 20px;
      font-weight: 700;
      margin: 8px 0;
    }

    .material-item .gwp-unit {
      font-size: 10px;
      color: #95a5a6;
    }

    .material-item .category-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    /* ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 350px;
      background: white;
      box-shadow: 2px 0 20px rgba(0,0,0,0.05);
      padding: 30px;
      position: sticky;
      top: 80px;
      height: calc(100vh - 100px);
      overflow-y: auto;
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 20px;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* 3D ë¯¸ë¦¬ë³´ê¸° */
    .preview-3d {
      width: 100%;
      height: 250px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    }

    .preview-3d canvas {
      width: 100%;
      height: 100%;
    }

    .preview-controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
      background: rgba(255,255,255,0.9);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 11px;
      color: #636e72;
    }

    .selected-layers {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .layer-item {
      background: var(--bg-light);
      padding: 15px;
      border-radius: 12px;
      position: relative;
      border-left: none; /* solid var(--primary-color); */
    }

    .layer-item .layer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .layer-item .layer-name {
      font-size: 14px;
      font-weight: 500;
      color: var(--dark);
    }

    .layer-item .remove-btn {
      background: #d63031;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      transition: var(--transition);
    }

    .layer-item .remove-btn:hover {
      background: #c0392b;
    }

    .layer-item .thickness-input {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }

    .layer-item .thickness-input label {
      font-size: 12px;
      color: #636e72;
    }

    .layer-item .thickness-input input {
      width: 80px;
      padding: 5px 10px;
      font-size: 12px;
    }

    .layer-item .carbon-info {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #dfe6e9;
      font-size: 12px;
      color: #636e72;
    }

    .total-carbon {
      margin-top: 20px;
      padding: 20px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: 12px;
      color: white;
      text-align: center;
    }

    .total-carbon .label {
      font-size: 12px;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .total-carbon .value {
      font-size: 28px;
      font-weight: 700;
    }

    .total-carbon .unit {
      font-size: 14px;
      margin-top: 5px;
    }

    .save-assembly-section {
      margin-top: 20px;
    }

    .save-assembly-section input {
      width: 100%;
      margin-bottom: 10px;
    }

    .save-assembly-section .btn {
      width: 100%;
      justify-content: center;
      display: flex;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #b2bec3;
    }

    .empty-state .icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    /* í•„í„° */
    @media (max-width: 1200px) {
      .page-wrapper {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        top: 0;
      }

      .pyramid-container {
        min-width: auto;
      }

      .pyramid-level::before {
        position: relative;
        left: 0;
        transform: none;
        display: block;
        margin-bottom: 10px;
      }

      .pyramid-level {
        max-width: 100% !important;
      }
    }
  </style>
</head>
<body>
  <!-- ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="main-nav">
    <!-- ì¢Œì¸¡: ë¡œê³  -->
    <div class="nav-brand">
      <a href="index.html" class="brand-link">
        <span class="logo-text">J.codE</span>
        <span class="logo-accent">M</span>
      </a>
    </div>

    <!-- ì¤‘ì•™: ë¶€ì¬ ë©”ë‰´ -->
    <div class="nav-menu">
      <a href="?type=floor" class="nav-btn" data-type="floor">
        ë°”ë‹¥
      </a>
      <a href="?type=external" class="nav-btn" data-type="external">
        ì™¸ë²½
      </a>
      <a href="?type=internal" class="nav-btn" data-type="internal">
        ë‚´ë²½
      </a>
      <a href="?type=ceiling" class="nav-btn" data-type="ceiling">
        ì²œì¥ ë§ˆê°
      </a>
    </div>

    <!-- ìš°ì¸¡: ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="nav-actions">
      <a href="assembly-comparison.html" class="action-btn comparison-btn">
        ì–´ì…ˆë¸”ë¦¬ ë¹„êµ
      </a>
      <a href="index.html" class="action-btn home-btn">
        ë©”ì¸ìœ¼ë¡œ
      </a>
    </div>
  </nav>

  <div class="page-wrapper">
    <!-- ë©”ì¸ ì»¨í…ì¸  - í”¼ë¼ë¯¸ë“œ -->
    <main class="main-content">
      <!-- ìì¬ ì¹´í…Œê³ ë¦¬ í•„í„° -->
      <div class="material-filters">
        <button class="filter-btn active" onclick="filterMaterials('all')" data-filter="all">
          ì „ì²´
        </button>
        <button class="filter-btn" onclick="filterMaterials('êµ¬ì¡°ì¬')" data-filter="êµ¬ì¡°ì¬">
          êµ¬ì¡°ì¬
        </button>
        <button class="filter-btn" onclick="filterMaterials('ë‹¨ì—´ì¬')" data-filter="ë‹¨ì—´ì¬">
          ë‹¨ì—´ì¬
        </button>
        <button class="filter-btn" onclick="filterMaterials('ë§ˆê°ì¬')" data-filter="ë§ˆê°ì¬">
          ë§ˆê°ì¬
        </button>
        <button class="filter-btn" onclick="filterMaterials('ë°©ìˆ˜ì¬')" data-filter="ë°©ìˆ˜ì¬">
          ë°©ìˆ˜ì¬
        </button>
      </div>

      <!-- í”¼ë¼ë¯¸ë“œ ë°°ê²½ ìœ„ì— ìì¬ íƒ€ì¼ ë°°ì¹˜ -->
      <div class="pyramid-stage">
        <div class="pyramid-background"></div>
        <div class="pyramid-tiles" id="pyramidTiles">
          <!-- ìì¬ íƒ€ì¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
      </div>
    </main>

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <h2>ğŸ—ï¸ Assembly making</h2>

      <!-- 3D ë¯¸ë¦¬ë³´ê¸° -->
      <div class="preview-3d" id="preview3D">
      </div>

      <div id="selectedLayers" class="selected-layers">
        <div class="empty-state">
          <div class="icon">ğŸ“¦</div>
          <p>â† ìì¬ë¥¼ ì„ íƒí•˜ì—¬<br>ì–´ì…ˆë¸”ë¦¬ë¥¼ ë§Œë“œì„¸ìš”</p>
        </div>
      </div>

      <div class="total-carbon">
        <div class="label">ì´ íƒ„ì†Œ ë°°ì¶œëŸ‰ (1mÂ²)</div>
        <div class="value" id="totalCarbon">0</div>
        <div class="unit">kg COâ‚‚eq/mÂ²</div>
      </div>

      <div class="save-assembly-section">
      <label for="assemblyName" style="display: block; margin-bottom: 5px; color: #636e72; font-size: 13px;">
        ì–´ì…ˆë¸”ë¦¬ ì´ë¦„
      </label>
        <input
          type="text"
          id="assemblyName"
          placeholder="floor 01"
        >
      <label for="assemblyArea" style="display: block; margin-bottom: 5px; color: #636e72; font-size: 13px;">
        ì ìš©ë©´ì (mÂ²)
      </label>
      <input
        type="number"
        id="assemblyArea"
        placeholder="ì˜ˆ: 1"
        value="1"
        min="0.01"
        step="0.01"
      >
        <button class="btn btn-primary" onclick="saveAssembly()">
          ğŸ’¾ ì–´ì…ˆë¸”ë¦¬ ì €ì¥
        </button>
        <button class="btn btn-secondary" onclick="clearLayers()" style="margin-top: 10px;">
          ğŸ—‘ï¸ ìì¬ì„ íƒ ì´ˆê¸°í™”
        </button>
      </div>
    </aside>
  </div>

  <script src="data/epd-korea.js"></script>
  <script src="js/calculator.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"
          integrity="sha512-dLxUelApnYxpLt6K2iomGngnHO83iUvZytA3YjDUCjT0HDOHKXnVYdf3hU4JjM8uEhxf9nD1/ey98U3t2vZ0qQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script>
    // XSS ë°©ì§€ë¥¼ ìœ„í•œ HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      if (text == null) return '';
      const div = document.createElement('div');
      div.textContent = String(text);
      return div.innerHTML;
    }

    const urlParams = new URLSearchParams(window.location.search);
    const structureType = urlParams.get('type') || 'floor';

    let selectedLayers = [];
    let currentFilter = 'all';
    let materials = [];

    // 3D ê´€ë ¨ ë³€ìˆ˜
    let scene3D, camera3D, renderer3D, layerMeshes = [], group3D;
    let isDragging = false;
    let previousMousePosition = { x: 0, y: 0 };

    // ìì¬ë³„ ì´ë¯¸ì§€ ë§¤í•‘ (Picsum Photos)
    const MATERIAL_IMAGE_MAP = {
      // ì½˜í¬ë¦¬íŠ¸ë¥˜ - íšŒìƒ‰ ê±°ì¹œ ì§ˆê°
      'concrete': 'images/concrete.jpg',
      'cement': 'images/concrete.jpg',
      'mortar': 'images/mortar.jpg',

      // ë²½ëŒ/ë¸”ë¡ - ë¶‰ì€ìƒ‰/ê°ˆìƒ‰
      'brick': 'https://picsum.photos/id/152/100/100',
      'block': 'https://picsum.photos/id/206/100/100',

      // ëª©ì¬ - ë‚˜ë¬´ê²°
      'wood': 'https://picsum.photos/id/175/100/100',
      'timber': 'https://picsum.photos/id/180/100/100',
      'plywood': 'https://picsum.photos/id/193/100/100',
      'lumber': 'https://picsum.photos/id/225/100/100',
      'flooring': 'https://picsum.photos/id/381/100/100',

      // ë‹¨ì—´ì¬ - ë…¸ë€ìƒ‰/í°ìƒ‰
      'insulation': 'images/eps.jpg',
      'xps': 'images/xps.jpg',
      'eps': 'images/eps.jpg',
      'glasswool': 'images/glasswool.jpg',
      'rockwool': 'images/rockwool.jpg',

      // ì„ê³ ë³´ë“œ - í°ìƒ‰
      'gypsum': 'https://picsum.photos/id/47/100/100',
      'plaster': 'https://picsum.photos/id/102/100/100',

      // íƒ€ì¼/ì„¸ë¼ë¯¹ - ê´‘íƒ
      'tile': 'images/ceramictile.jpg',
      'ceramic': 'images/ceramictile.jpg',
      'porcelain': 'images/ceramictile.jpg',

      // ê¸ˆì† - ì€ìƒ‰/íšŒìƒ‰
      'steel': 'images/steel.jpg',
      'aluminum': 'images/aluminum.jpg',
      'metal': 'images/steel.jpg',

      // ìœ ë¦¬
      'glass': 'images/double.jpg',

      // ë°©ìˆ˜ì¬ - ê²€ì •ìƒ‰
      'waterproof': 'images/urethanwaterproof.jpg',
      'asphalt': 'images/asphaltwaterproof.jpg',

      // í˜ì¸íŠ¸ - ë°ì€ìƒ‰
      'paint': 'images/paint.jpg',

      // ê¸°ë³¸ê°’
      'default': 'https://picsum.photos/id/50/100/100'
    };

    // ìì¬ëª…ìœ¼ë¡œ ì´ë¯¸ì§€ URL ì°¾ê¸°
    function getMaterialImageUrl(material) {
      const name = material.name.toLowerCase();

      // í‚¤ì›Œë“œ ë§¤ì¹­
      for (const [keyword, url] of Object.entries(MATERIAL_IMAGE_MAP)) {
        if (name.includes(keyword) ||
            name.includes(keyword.replace(/[aeiou]/g, '')) ||
            material.id?.includes(keyword)) {
          return url;
        }
      }

      // í•œê¸€ í‚¤ì›Œë“œ ë§¤ì¹­
      if (name.includes('ì½˜í¬ë¦¬íŠ¸')) return MATERIAL_IMAGE_MAP.concrete;
      if (name.includes('ë²½ëŒ')) return MATERIAL_IMAGE_MAP.brick;
      if (name.includes('ëª©ì¬') || name.includes('ë§ˆë£¨') || name.includes('ì›ëª©')) return MATERIAL_IMAGE_MAP.wood;
      if (name.includes('ë‹¨ì—´') || name.includes('ì•”ë©´') || name.includes('ìœ ë¦¬ë©´')) return MATERIAL_IMAGE_MAP.insulation;
      if (name.includes('ì„ê³ ')) return MATERIAL_IMAGE_MAP.gypsum;
      if (name.includes('íƒ€ì¼')) return MATERIAL_IMAGE_MAP.tile;
      if (name.includes('ê¸ˆì†') || name.includes('ê°•íŒ') || name.includes('ì•Œë£¨ë¯¸ëŠ„')) return MATERIAL_IMAGE_MAP.metal;
      if (name.includes('ë°©ìˆ˜') || name.includes('ì•„ìŠ¤íŒ”íŠ¸')) return MATERIAL_IMAGE_MAP.waterproof;
      if (name.includes('í˜ì¸íŠ¸')) return MATERIAL_IMAGE_MAP.paint;

      return MATERIAL_IMAGE_MAP.default;
    }

    // 3D ì´ˆê¸°í™”
    function init3DPreview() {
      const container = document.getElementById('preview3D');
      const width = container.clientWidth;
      const height = 250;

      scene3D = new THREE.Scene();
      camera3D = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
      renderer3D = new THREE.WebGLRenderer({ antialias: true, alpha: true });

      renderer3D.setSize(width, height);
      renderer3D.setClearColor(0x000000, 0);
      renderer3D.shadowMap.enabled = true;
      renderer3D.shadowMap.type = THREE.PCFSoftShadowMap;
      container.insertBefore(renderer3D.domElement, container.firstChild);

      // ê°œì„ ëœ ì¡°ëª…
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene3D.add(ambientLight);

      const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight1.position.set(5, 10, 7);
      directionalLight1.castShadow = true;
      directionalLight1.shadow.camera.near = 0.1;
      directionalLight1.shadow.camera.far = 50;
      scene3D.add(directionalLight1);

      const directionalLight2 = new THREE.DirectionalLight(0x74b9ff, 0.3);
      directionalLight2.position.set(-5, 5, -5);
      scene3D.add(directionalLight2);

      const directionalLight3 = new THREE.DirectionalLight(0xffeaa7, 0.2);
      directionalLight3.position.set(0, -5, 5);
      scene3D.add(directionalLight3);

      // ì¹´ë©”ë¼ ìœ„ì¹˜
      const isWall = (structureType === 'external' || structureType === 'internal');
      if (isWall) {
        camera3D.position.set(0, 1, 4);
      } else {
        camera3D.position.set(2.5, 2, 2.5);
      }
      camera3D.lookAt(0, 0, 0);

      // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
      renderer3D.domElement.addEventListener('mousedown', onMouseDown);
      renderer3D.domElement.addEventListener('mousemove', onMouseMove);
      renderer3D.domElement.addEventListener('mouseup', onMouseUp);
      renderer3D.domElement.addEventListener('wheel', onWheel);

      animate3D();
    }

    // 3D ì• ë‹ˆë©”ì´ì…˜
    function animate3D() {
      requestAnimationFrame(animate3D);

      // ìë™ íšŒì „ ì¶”ê°€
      if (group3D && !isDragging) {
        group3D.rotation.y += 0.005; // ì²œì²œíˆ Yì¶• íšŒì „
      }

      renderer3D.render(scene3D, camera3D);
    }

    // ìì¬ íƒ€ì…ë³„ ì¬ì§ˆ ì†ì„±
    function getMaterialProperties(material) {
      const name = material.name.toLowerCase();

      // ì½˜í¬ë¦¬íŠ¸
      if (name.includes('ì½˜í¬ë¦¬íŠ¸')) {
        return {
          color: 0x8b8d8f,
          roughness: 0.9,
          metalness: 0,
          emissive: 0x000000,
          shininess: 5
        };
      }
      // ë‹¨ì—´ì¬ (XPS, EPS, ìœ ë¦¬ë©´, ì•”ë©´)
      if (name.includes('ë‹¨ì—´') || name.includes('xps') || name.includes('eps') ||
          name.includes('ìœ ë¦¬ë©´') || name.includes('ì•”ë©´') || name.includes('ìŠ¤í‹°ë¡œí¼')) {
        return {
          color: 0xffd93d,
          roughness: 0.95,
          metalness: 0,
          emissive: 0xffd93d,
          emissiveIntensity: 0.05,
          shininess: 2
        };
      }
      // ì„ê³ ë³´ë“œ
      if (name.includes('ì„ê³ ')) {
        return {
          color: 0xf5f5f5,
          roughness: 0.7,
          metalness: 0,
          emissive: 0x000000,
          shininess: 10
        };
      }
      // ëª©ì¬
      if (name.includes('ë§ˆë£¨') || name.includes('ëª©ì¬') || name.includes('ìŠ¤í„°ë“œ') || name.includes('ì›ëª©')) {
        return {
          color: 0x8b6f47,
          roughness: 0.8,
          metalness: 0,
          emissive: 0x000000,
          shininess: 20
        };
      }
      // ë²½ëŒ
      if (name.includes('ë²½ëŒ') || name.includes('ì ë²½')) {
        return {
          color: 0xa0522d,
          roughness: 0.95,
          metalness: 0,
          emissive: 0x000000,
          shininess: 3
        };
      }
      // íƒ€ì¼, ì„¸ë¼ë¯¹
      if (name.includes('íƒ€ì¼') || name.includes('ì„¸ë¼ë¯¹')) {
        return {
          color: 0xe8e8e8,
          roughness: 0.1,
          metalness: 0.3,
          emissive: 0xffffff,
          emissiveIntensity: 0.05,
          shininess: 100
        };
      }
      // ëª¨ë¥´íƒ€ë¥´, ë¯¸ì¥
      if (name.includes('ëª¨ë¥´íƒ€ë¥´') || name.includes('ëª°íƒˆ') || name.includes('ë¯¸ì¥') || name.includes('ì‹œë©˜íŠ¸')) {
        return {
          color: 0xb8b8b8,
          roughness: 0.85,
          metalness: 0,
          emissive: 0x000000,
          shininess: 5
        };
      }
      // ë°©ìˆ˜ì¸µ
      if (name.includes('ë°©ìˆ˜') || name.includes('ì•„ìŠ¤íŒ”íŠ¸') || name.includes('ìš°ë ˆíƒ„')) {
        return {
          color: 0x1a1a1a,
          roughness: 0.3,
          metalness: 0.2,
          emissive: 0x000000,
          shininess: 40
        };
      }
      // ê¸ˆì† (ì•Œë£¨ë¯¸ëŠ„, ê°•íŒ, ì² )
      if (name.includes('ê¸ˆì†') || name.includes('ì•Œë£¨ë¯¸ëŠ„') || name.includes('ê°•íŒ') ||
          name.includes('ì² ') || name.includes('ìŠ¤í‹¸')) {
        return {
          color: 0xc0c0c0,
          roughness: 0.2,
          metalness: 0.9,
          emissive: 0x444444,
          emissiveIntensity: 0.1,
          shininess: 100
        };
      }
      // í˜ì¸íŠ¸
      if (name.includes('í˜ì¸íŠ¸') || name.includes('ë„ì¥')) {
        return {
          color: 0xffffff,
          roughness: 0.4,
          metalness: 0,
          emissive: 0xffffff,
          emissiveIntensity: 0.05,
          shininess: 60
        };
      }
      // ê¸°ë³¸ê°’
      return {
        color: 0x00b894,
        roughness: 0.7,
        metalness: 0,
        emissive: 0x000000,
        shininess: 30
      };
    }

    // 3D ë ˆì´ì–´ ì—…ë°ì´íŠ¸
    function update3DLayers() {
      // ê¸°ì¡´ ê·¸ë£¹ ì œê±°
      if (group3D) {
        scene3D.remove(group3D);
      }

      // ìƒˆ ê·¸ë£¹ ìƒì„±
      group3D = new THREE.Group();
      layerMeshes = [];

      if (selectedLayers.length === 0) return;

      const isWall = (structureType === 'external' || structureType === 'internal');
      let pos = 0;

      selectedLayers.forEach((layer, index) => {
        const thickness = layer.thickness / 1000; // mmë¥¼ më¡œ ë³€í™˜
        let geometry, mesh;

        // ìì¬ë³„ ì¬ì§ˆ ì†ì„± ê°€ì ¸ì˜¤ê¸°
        const matProps = getMaterialProperties(layer.material);

        if (isWall) {
          // ë²½ì²´ (ê°€ë¡œë¡œ ìŒ“ì„)
          geometry = new THREE.BoxGeometry(thickness, 2, 1.3);
          mesh = new THREE.Mesh(geometry, new THREE.MeshStandardMaterial({
            color: matProps.color,
            roughness: matProps.roughness,
            metalness: matProps.metalness,
            emissive: matProps.emissive,
            emissiveIntensity: matProps.emissiveIntensity || 0,
            transparent: thickness < 0.05,
            opacity: thickness < 0.05 ? 0.85 : 1
          }));
          mesh.position.x = pos + thickness / 2;
          mesh.castShadow = true;
          mesh.receiveShadow = true;
        } else {
          // ë°”ë‹¥/ì§€ë¶• (ìœ„ë¡œ ìŒ“ì„)
          geometry = new THREE.BoxGeometry(2, thickness, 1.3);
          mesh = new THREE.Mesh(geometry, new THREE.MeshStandardMaterial({
            color: matProps.color,
            roughness: matProps.roughness,
            metalness: matProps.metalness,
            emissive: matProps.emissive,
            emissiveIntensity: matProps.emissiveIntensity || 0,
            transparent: thickness < 0.05,
            opacity: thickness < 0.05 ? 0.85 : 1
          }));
          mesh.position.y = pos + thickness / 2;
          mesh.castShadow = true;
          mesh.receiveShadow = true;
        }

        // ì™¸ê³½ì„  ì¶”ê°€ (ë” ë‘ê»ê²Œ)
        const edges = new THREE.EdgesGeometry(geometry);
        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({
          color: 0x000000,
          linewidth: 2,
          opacity: 0.6,
          transparent: true
        }));
        mesh.add(line);

        // ë¼ë²¨ ì¶”ê°€ (ìì¬ëª…) - ì œê±°ë¨
        /*
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 512;
        canvas.height = 128;

        context.fillStyle = 'rgba(255, 255, 255, 0.9)';
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = '#2d3436';
        context.font = 'bold 48px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(layer.material.name, canvas.width / 2, canvas.height / 2);

        const texture = new THREE.CanvasTexture(canvas);
        const labelMaterial = new THREE.SpriteMaterial({ map: texture, transparent: true });
        const label = new THREE.Sprite(labelMaterial);
        label.scale.set(1, 0.25, 1);

        if (isWall) {
          label.position.set(0, 0, 0.7);
        } else {
          label.position.set(0, 0, 0.7);
        }
        mesh.add(label);
        */

        pos += thickness;
        group3D.add(mesh);  // sceneì´ ì•„ë‹Œ groupì— ì¶”ê°€
        layerMeshes.push(mesh);
      });

      // ì „ì²´ ì¤‘ì‹¬ ë§ì¶”ê¸°
      const totalSize = pos;
      layerMeshes.forEach(mesh => {
        if (isWall) {
          mesh.position.x -= totalSize / 2;
        } else {
          mesh.position.y -= totalSize / 2;
        }
      });

      // ê·¸ë£¹ì„ sceneì— ì¶”ê°€
      scene3D.add(group3D);
    }

    // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ íšŒì „
    function onMouseDown(e) {
      isDragging = true;
      previousMousePosition = { x: e.clientX, y: e.clientY };
    }

    function onMouseMove(e) {
      if (!isDragging || !group3D) return;

      const deltaX = e.clientX - previousMousePosition.x;
      const deltaY = e.clientY - previousMousePosition.y;

      // ê°œë³„ meshê°€ ì•„ë‹Œ group ì „ì²´ë¥¼ íšŒì „
      group3D.rotation.y += deltaX * 0.01;
      group3D.rotation.x += deltaY * 0.01;

      previousMousePosition = { x: e.clientX, y: e.clientY };
    }

    function onMouseUp() {
      isDragging = false;
    }

    // ë§ˆìš°ìŠ¤ íœ ë¡œ ì¤Œ
    function onWheel(e) {
      e.preventDefault();
      camera3D.position.z += e.deltaY * 0.01;
      camera3D.position.z = Math.max(2, Math.min(8, camera3D.position.z));
    }

    // ì´ˆê¸°í™”
    function init() {
      materials = KOREAN_EPD[structureType]?.materials || [];

      // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ì„¤ì •
      updateNavigation();

      // í•„í„° ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
      updateFilterButtons();

      // 3D ì´ˆê¸°í™”
      init3DPreview();

      renderPyramid();
    }

    // êµ¬ì¡° íƒ€ì…ì— ë”°ë¼ í•„í„° ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
    function updateFilterButtons() {
      const hideFilters = {
        ceiling: ['êµ¬ì¡°ì¬', 'ë‹¨ì—´ì¬', 'ë°©ìˆ˜ì¬']
      };

      const filtersToHide = hideFilters[structureType] || [];

      document.querySelectorAll('.filter-btn').forEach(btn => {
        const filter = btn.getAttribute('data-filter');
        if (filtersToHide.includes(filter)) {
          btn.style.display = 'none';
        } else {
          btn.style.display = '';
        }
      });
    }

    // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateNavigation() {
      document.querySelectorAll('.nav-btn').forEach(btn => {
        const btnType = btn.getAttribute('data-type');
        if (btnType === structureType) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // í”¼ë¼ë¯¸ë“œ ë Œë”ë§ (Denmark ì ˆëŒ€ê°’ ê¸°ì¤€)
    function renderPyramid() {
      const container = document.getElementById('pyramidTiles');
      const pyramidStage = document.querySelector('.pyramid-stage');

      // ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©
      let filtered = materials;
      if (currentFilter !== 'all') {
        filtered = materials.filter(m => {
          // ìœ ì—°í•œ ì¹´í…Œê³ ë¦¬ ë§¤ì¹­
          if (currentFilter === 'êµ¬ì¡°ì¬') {
            return m.categoryName === 'êµ¬ì¡°ì¬';
          } else if (currentFilter === 'ë‹¨ì—´ì¬') {
            return m.categoryName.includes('ë‹¨ì—´');
          } else if (currentFilter === 'ë§ˆê°ì¬') {
            return ['ë§ˆê°ì¬', 'ì™¸ì¥ì¬', 'ì§€ë¶•ì¬', 'ì²œì¥ì¬', 'ë‹¬ëŒ€'].includes(m.categoryName);
          } else if (currentFilter === 'ë°©ìˆ˜ì¬') {
            return m.categoryName.includes('ë°©ìˆ˜');
          }
          return m.categoryName === currentFilter;
        });
      }

      // GWP ìˆœìœ¼ë¡œ ì •ë ¬
      filtered.sort((a, b) => b.gwp - a.gwp); // ë†’ì€ ê²ƒë¶€í„° ì •ë ¬

      // ìì¬ê°€ ì—†ì–´ë„ ë¹ˆ í”¼ë¼ë¯¸ë“œ êµ¬ì¡° ìœ ì§€ (return í•˜ì§€ ì•ŠìŒ)
      const showEmptyMessage = filtered.length === 0;

      // 5ê°œ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜
      const groups = [[], [], [], [], []]; // 5ê°œ ê·¸ë£¹

      filtered.forEach(material => {
        const gwp = material.gwp;
        let group;

        if (gwp >= 10000) {
          group = 0; // ê·¸ë£¹ 1: 10,000 ì´ìƒ (1~2í–‰)
        } else if (gwp >= 1000) {
          group = 1; // ê·¸ë£¹ 2: 1,000 ì´ìƒ (3~5í–‰)
        } else if (gwp >= 100) {
          group = 2; // ê·¸ë£¹ 3: 100 ì´ìƒ (6~7í–‰)
        } else if (gwp >= 0) {
          group = 3; // ê·¸ë£¹ 4: 0 ì´ìƒ (8~9í–‰)
        } else {
          group = 4; // ê·¸ë£¹ 5: ìŒìˆ˜ (10~11í–‰)
        }

        groups[group].push(material);
      });

      // ê° ê·¸ë£¹ì˜ í–‰ ë°°ì •
      const groupRowConfigs = [
        { rows: [1, 2], level: 1 },           // ê·¸ë£¹ 1: 1~2í–‰ (ë¹¨ê°•)
        { rows: [3, 4, 5], level: 2 },        // ê·¸ë£¹ 2: 3~5í–‰ (ì£¼í™©)
        { rows: [6, 7], level: 3 },           // ê·¸ë£¹ 3: 6~7í–‰ (í•˜ëŠ˜ìƒ‰)
        { rows: [8, 9], level: 4 },           // ê·¸ë£¹ 4: 8~9í–‰ (ë¯¼íŠ¸)
        { rows: [10, 11], level: 5 }          // ê·¸ë£¹ 5: 10~11í–‰ (ë…¹ìƒ‰)
      ];

      // 11ê°œ í–‰ìœ¼ë¡œ ë‚˜ëˆ„ê¸° (ìŠ¬ë¡¯ ê°œìˆ˜: 1,2,3,4,6,7,8,10,12,14,16)
      const rowSlotCounts = [1, 2, 3, 4, 6, 7, 8, 10, 12, 14, 16]; // 11ê°œ í–‰

      let html = '';

      // ê° ê·¸ë£¹ ì²˜ë¦¬
      groups.forEach((groupMaterials, groupIndex) => {
        const config = groupRowConfigs[groupIndex];
        const rowIndices = config.rows.map(r => r - 1); // í–‰ ë²ˆí˜¸ë¥¼ ì¸ë±ìŠ¤ë¡œ ë³€í™˜ (1-based â†’ 0-based)
        const level = config.level;
        const isLastGroup = groupIndex === groups.length - 1;

        let materialIndex = 0; // ì´ ê·¸ë£¹ ë‚´ì—ì„œì˜ ìì¬ ì¸ë±ìŠ¤

        // ê·¸ë£¹ì˜ ê° í–‰ ìƒì„±
        rowIndices.forEach((rowIndex, rowIndexInGroup) => {
          const rowNumber = rowIndex + 1; // ë‹¤ì‹œ 1-basedë¡œ
          const slotCount = rowSlotCounts[rowIndex]; // í•´ë‹¹ í–‰ì˜ ìŠ¬ë¡¯ ê°œìˆ˜
          const isLastRowInGroup = rowIndexInGroup === rowIndices.length - 1;

          // ìŠ¬ë¡¯ ê°œìˆ˜ë§Œí¼ íƒ€ì¼ ìƒì„±
          const tiles = [];
          for (let i = 0; i < slotCount; i++) {
            const material = groupMaterials[materialIndex];

            if (material) {
              // ìì¬ê°€ ìˆìœ¼ë©´ íƒ€ì¼ ìƒì„±
              const isSelected = selectedLayers.some(l => l.material.id === material.id);
              const imageUrl = getMaterialImageUrl(material);

              tiles.push(`
                <div class="material-tile ${isSelected ? 'selected' : ''} level-${level}"
                     style="background-image: url('${escapeHtml(imageUrl)}')"
                     tabindex="0"
                     role="button"
                     aria-label="${escapeHtml(material.name)} - GWP: ${formatNumber(material.gwp, 0)} kg COâ‚‚eq"
                     onclick="selectMaterial('${escapeHtml(material.id)}')"
                     onkeypress="if(event.key==='Enter') selectMaterial('${escapeHtml(material.id)}')"
                     data-id="${escapeHtml(material.id)}">
                  <div class="gwp-badge">${formatNumber(Math.abs(material.gwp), 0)}</div>
                  <div class="level-indicator"></div>
                  <div class="tile-info">
                    <span class="tile-name">${escapeHtml(material.name)}</span>
                    <span class="tile-gwp">${formatNumber(material.gwp, 0)} COâ‚‚</span>
                  </div>
                </div>
              `);
              materialIndex++; // ìì¬ë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ì¸ë±ìŠ¤ ì¦ê°€
            } else {
              // ìì¬ê°€ ì—†ìœ¼ë©´ ë¹ˆ ìŠ¬ë¡¯
              tiles.push(`
                <div class="material-tile empty-slot level-${level}">
                  <div class="empty-slot-label">-</div>
                </div>
              `);
            }
          }

          // ë§ˆì§€ë§‰ ê·¸ë£¹ì´ ì•„ë‹Œ ê²½ìš°, ê·¸ë£¹ì˜ ë§ˆì§€ë§‰ í–‰ì—ë§Œ êµ¬ë¶„ì„  ì¶”ê°€
          const showBorder = isLastRowInGroup && !isLastGroup;
          html += `
            <div class="pyramid-row level-${level} row-${rowNumber} ${showBorder ? 'group-end' : ''}">
              ${tiles.join('')}
            </div>
          `;
        });
      });

      container.innerHTML = html;

      // ìì¬ê°€ ì—†ìœ¼ë©´ ë©”ì‹œì§€ ì˜¤ë²„ë ˆì´ ì¶”ê°€
      if (showEmptyMessage) {
        container.insertAdjacentHTML('beforeend', '<div class="empty-materials-overlay">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ìì¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>');
      }

      // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateMaterialCards();

      // í”¼ë¼ë¯¸ë“œ ë¡œë“œ ì™„ë£Œ í‘œì‹œ - requestAnimationFrameìœ¼ë¡œ ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ì‹¤í–‰
      requestAnimationFrame(() => {
        pyramidStage.classList.add('loaded');
      });
    }

    // ìì¬ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateMaterialCards() {
      document.querySelectorAll('.material-tile').forEach(tile => {
        const materialId = tile.getAttribute('data-id');
        const isSelected = selectedLayers.some(l => l.material.id === materialId);

        if (isSelected) {
          tile.classList.add('selected');
        } else {
          tile.classList.remove('selected');
        }
      });
    }

    // ìì¬ ì„ íƒ
    function selectMaterial(materialId) {
      const material = materials.find(m => m.id === materialId);
      if (!material) return;

      selectedLayers.push({
        material: material,
        thickness: 100,
        id: Date.now()
      });

      updateSelectedLayers();
      updateTotalCarbon();
      updateMaterialCards(); // íƒ€ì¼ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
      update3DLayers(); // 3D ì—…ë°ì´íŠ¸
    }

    // ì„ íƒëœ ë ˆì´ì–´ ì—…ë°ì´íŠ¸
    function updateSelectedLayers() {
      const container = document.getElementById('selectedLayers');

      if (selectedLayers.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">ğŸ“¦</div>
            <p>ìì¬ë¥¼ í´ë¦­í•˜ì—¬<br>ë ˆì´ì–´ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</p>
          </div>
        `;
        return;
      }

      container.innerHTML = selectedLayers.map((layer, index) => {
        const carbon = calculator.calculateLayerCarbon(layer.material, layer.thickness, 1);

        return `
          <div class="layer-item">
            <div class="layer-header">
              <span class="layer-name">${index + 1}. ${escapeHtml(layer.material.name)}</span>
              <button class="remove-btn" onclick="removeLayer(${layer.id})">âœ•</button>
            </div>
            <div class="thickness-input">
              <label>ë‘ê»˜:</label>
              <input
                type="number"
                value="${layer.thickness}"
                min="1"
                step="1"
                onchange="updateThickness(${layer.id}, this.value)"
              >
              <span>mm</span>
            </div>
            <div class="carbon-info">
              íƒ„ì†Œë°°ì¶œ: ${formatNumber(carbon, 2)} kg COâ‚‚eq/mÂ²
            </div>
          </div>
        `;
      }).join('');
    }

    // ë ˆì´ì–´ ì œê±°
    function removeLayer(layerId) {
      selectedLayers = selectedLayers.filter(l => l.id !== layerId);
      updateSelectedLayers();
      updateTotalCarbon();
      updateMaterialCards(); // íƒ€ì¼ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
      update3DLayers(); // 3D ì—…ë°ì´íŠ¸
    }

    // ë‘ê»˜ ì—…ë°ì´íŠ¸
    function updateThickness(layerId, thickness) {
      const layer = selectedLayers.find(l => l.id === layerId);
      if (layer) {
        layer.thickness = parseFloat(thickness);
        updateSelectedLayers();
        updateTotalCarbon();
        update3DLayers(); // 3D ì—…ë°ì´íŠ¸
      }
    }

    // ì´ íƒ„ì†Œ ë°°ì¶œëŸ‰ ì—…ë°ì´íŠ¸
    function updateTotalCarbon() {
      const total = calculator.calculateAssemblyCarbon(selectedLayers, 1);
      document.getElementById('totalCarbon').textContent = formatNumber(total, 2);
    }

    // í•„í„°ë§
    function filterMaterials(filter) {
      currentFilter = filter;

      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

      renderPyramid();
    }

    // ë ˆì´ì–´ ì´ˆê¸°í™”
    function clearLayers() {
      if (selectedLayers.length === 0) return;

      if (confirm('ëª¨ë“  ë ˆì´ì–´ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        selectedLayers = [];
        updateSelectedLayers();
        updateTotalCarbon();
        updateMaterialCards(); // íƒ€ì¼ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        update3DLayers(); // 3D ì—…ë°ì´íŠ¸
      }
    }

    // ì–´ì…ˆë¸”ë¦¬ ì €ì¥
    function saveAssembly() {
      if (selectedLayers.length === 0) {
        alert('ë ˆì´ì–´ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
        return;
      }

      const name = document.getElementById('assemblyName').value.trim();
      if (!name) {
        alert('ì–´ì…ˆë¸”ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      if (name.length > 100) {
        alert('ì–´ì…ˆë¸”ë¦¬ ì´ë¦„ì€ 100ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const areaInput = document.getElementById('assemblyArea').value;
      const area = parseFloat(areaInput);
      if (isNaN(area) || area <= 0) {
        alert('ë©´ì ì€ 0ë³´ë‹¤ í° ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      if (area > 100000) {
        alert('ë©´ì ì€ 100,000mÂ² ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      calculator.addAssembly(name, structureType, selectedLayers, area);

      alert('ì–´ì…ˆë¸”ë¦¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');

      if (confirm('ì–´ì…ˆë¸”ë¦¬ ë¹„êµ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        window.location.href = 'assembly-comparison.html';
      } else {
        selectedLayers = [];
        document.getElementById('assemblyName').value = '';
        document.getElementById('assemblyArea').value = '1';
        updateSelectedLayers();
        updateTotalCarbon();
        updateMaterialCards();
        update3DLayers(); // 3D ì—…ë°ì´íŠ¸
      }
    }

    init();
  </script>
</body>
</html>
